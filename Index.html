<!DOCTYPE html>
<html ng-app="mobApp" lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script src="./jquery.js"></script>
    <script src="./angular-1.5.3/angular.min.js"></script>
    <script src="./angular-1.5.3/angular-route.min.js"></script>
    <script src="./angular-1.5.3/angular-animate.min.js"></script>
    <script src="./index.js"></script>
    <script src="./components/input/index.js"></script>
    <script src="./components/input-number/index.js"></script>
    <script src="./components/checkbox/index.js"></script>
    <script src="./components/checkbox-button/index.js"></script>
    <script src="./components/radio/index.js"></script>
    <script src="./components/radio-button/index.js"></script>
    <script src="./components/radio-group/index.js"></script>
    <!-- <script src="https://cdn.staticfile.net/angular.js/1.5.3/angular.min.js"></script> -->
    <!-- <script src="https://cdn.staticfile.net/angular.js/1.5.3/angular-route.min.js"></script> -->
    <link rel="stylesheet" href="prism/prism.css">
    <script type="text/javascript" src="decimal/decimal.js" data-manual></script>
    <script type="text/javascript" src="floatingui/floating-core-1.6.0.js"></script>
    <script type="text/javascript" src="floatingui/floating-ui-1.6.3.js"></script>
    <script type="text/javascript" src="prism/prism.js" data-manual></script>
    <link rel="stylesheet" href="./css/router-view.css">
    <link rel="stylesheet" href="./css/mob.css">
    <link rel="stylesheet" href="./css/mob-doc.css">
    <link rel="stylesheet" href="./css/mob-popper.css">
    <link rel="stylesheet" href="components/input/mob-input.css">
    <link rel="stylesheet" href="components/input-number/mob-input-number.css">
    <link rel="stylesheet" href="./css/mob-select.css">
    <link rel="stylesheet" href="./css/mob-select-options.css">
    <link rel="stylesheet" href="components/radio/mob-radio.css">
    <link rel="stylesheet" href="components/radio-button/mob-radio-button.css">
    <link rel="stylesheet" href="components/radio-group/mob-radio-group.css">
    <link rel="stylesheet" href="components/checkbox/mob-checkbox.css">
    >
    <link rel="stylesheet" href="components/checkbox-button/mob-checkbox-button.css">
    <link rel="stylesheet" href="components/checkbox-group/mob-checkbox-group.css">
    <link rel="stylesheet" href="./css/mob-divider.css">
</head>
<style>
    .contain {
        display: flex;
    }

    .navigation {
        position: fixed;
        padding: 20px 20px 0 0;
        width: 240px;
        height: 100%;
        background-color: #ffffff;
        margin-right: 20px;
        box-sizing: border-box;
        /*z-index: 1;*/
    }

    .navigation .nav-item {
        padding-left: 20px;
        height: 40px;
    }

    .navigation .nav-item a {
        display: flex;
        box-sizing: border-box;
        padding: 5px 20px;
        width: 100%;
        height: 40px;
        color: #444;
        align-items: center;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
        font-weight: 400;
        text-decoration: none;
        transition: all var(--mob-transition-duration);
        border-radius: 8px;
    }

    .navigation .nav-item a:hover {
        color: var(--mob-active-text-color);
    }

    .navigation .nav-item.is_active a {
        background-color: var(--mob-active-text-color-light);
        color: var(--mob-active-text-color);
    }
</style>

<body ng-controller="IndexCtrl as ctrl">
<!-- <div>
    <p>最外面的</p>
    {{ctrl.form}}
    <br>
    ------
    <div style="width: 200px;">
        <mob-form form-item="ctrl.formItem" model="ctrl.form"></mob-form>
    </div>
</div> -->
<div class="contain" style="display: flex;">

    <div class="navigation" style="z-index: 1">
        <!-- <a href="#!/home">Home</a> -->
        <div class="nav-item" ng-class="{'is_active':item.path === routPath}" ng-repeat="item in menuList">
            <a href="{{'#' + item.path}}" ng-bind="item.label">home</a>
        </div>
    </div>

    <div>
        <div ng-view="" class="view-animate-container">
        </div>
    </div>
</div>

<script type="text/ng-template" id="home">
    <h1 style="margin-top:20px"> 参考Element UI ，基于Angular1.5.3开发的UI框架 </h1>
    <ul>
        <li>目前的插件都是直接操作<code>dom</code>的，并没有使用<code>Angular</code>的双向数据绑定机制，采用数据驱动的方式实现；经常出现下拉框、多选框，点击保存后，在新增，还是会显示上一步操作的内容
        </li>
    </ul>
</script>

</body>
<script>
    const BOOLEAN_CUSTOM_ATTR = new Set();
    angular.forEach("clearable,showPassword".split(","), function (value) {
        BOOLEAN_CUSTOM_ATTR.add(value)
    })

    app
        .controller('IndexCtrl', ['$route', function IndexCtrl($route) {
            this.hero = {
                name: 'Spawn'
            };
            this.form = {};
            this.formItem = [
                {type: 'input', label: 'clearableInput', prop: 'clearableInput', options: {clearable: true}},
                {type: 'input', label: 'disableInput', prop: 'disableInput', options: {disable: true}},
                {type: 'input', label: 'showPasswordInput', prop: 'showPasswordInput', options: {showPassword: true}},
                {
                    type: 'select',
                    label: '名称1',
                    prop: 'name2',
                    options: {
                        clearable: true,
                        dataDic: [{label: 'Option1', value: 'Option1'}, {label: 'Option2', value: 'Option2'}]
                    }
                },
            ];
        }])
        .controller('InputCtrl', ['$scope', function IndexCtrl($scope) {
        }])
        .controller('RadioCtrl', ['$scope', function RadioCtrl($scope) {

            this.radioIndex = -1;
            this.radioGroupModel = '';
            this.radioGroup = [
                {label: '北京', value: '北京'},
                {label: '上海', value: '上海'},
                {label: '广州', value: '广州'}
            ]

            this.changeRadioGroupModel = function () {
                this.radioIndex = this.radioIndex + 1;
                if (this.radioIndex > this.radioGroup.length - 1) {
                    this.radioIndex = 0;
                }
                this.radioGroupModel = this.radioGroup[this.radioIndex].value
            }
            this.demo = 'Options1'
            this.fatherChange = function (value) {
            }
        }])
        .controller('CheckBoxCtrl', ['$scope', function CheckBoxCtrl($scope) {
            this.fatherChange = function (value) {
            }
        }])
        .controller('MultipleCheckBoxGroupCtrl', ['$scope', function MultipleCheckBoxGroupCtrl($scope) {
            this.multipleCheckBoxGroup = ['Option5']


            this.checkAll = false;
            this.indeterminate = true
            this.checkedCities = ['澳门', '上海'];
            this.changeTag = true;
            this.cities = ['北京', '上海', '广东', '深圳', '香港', '澳门']

            this.checkAllChange = function () {
                // 是否全选
                this.checkAll = !this.checkAll
                // 无实际应用，仅仅是为了告诉group，需要发送事件通知子组件
                this.changeTag = !this.changeTag
                // 赋值
                this.checkedCities = this.checkAll ? [...this.cities] : []
            }


            this.checkboxChangeHandle = function () {
                let checkCount = this.checkedCities.length
                this.checkAll = checkCount === this.cities.length
                this.indeterminate = checkCount > 0 && checkCount < this.cities.length
            }

            this.min = 2
            this.changeMin = function () {
                this.min = this.min + 1
            }
        }])
        .controller('InputNumberCtrl', ['$scope', function InputNumberCtrl($scope) {
            this.value = 1

            this.value2 = 2

            this.value3 = 2.5

            this.value4 = 3.5
        }])
        .controller('PopperCtrl', ['$scope', 'floating', 'uuId', function CheckBoxCtrl($scope, floating, uuId) {
            var vm = this;
            this.message = 'Welcome to School Buddy!';

        }])
        .controller('SelectCtrl', ['$scope', function InputNumberCtrl($scope) {
            this.optionsBase = [
                {label: '香港', value: '香港', desc:'XiangGang'},
                {label: '澳门', value: '澳门', desc:'AoMen'},
                {label: '北京', value: '北京', desc:'BeiJing'},
                {label: '上海', value: '上海', desc:'ShangHai'},
                {label: '深圳', desc:'ShenZheng'},
                {label: '江苏', desc:'JiangSu'},
                {label: '广州', desc:'GuangZhou'},
            ]

            this.optionsDisabled = [
                {label: '香港', value: '香港'},
                {label: '澳门', value: '澳门', disabled: true},
                {label: '北京', value: '北京'},
                {label: '上海', value: '上海'},
                {label: '广州'},
                {label: '深圳深圳深圳深圳深圳深圳深圳深圳深圳深圳深圳深圳深圳深圳深圳深圳深圳', value: '1'},
            ]

            $scope.demo = 'Select'
            $scope.value = '香港'
            $scope.value3 = '香港'
            $scope.valueMultiple = ['香港','1','上海','北京']
        }])
    ;
    app
        .directive('prism', function () {
            return {
                restrict: 'A',
                compile: function () {
                    return function (scope, element) {

                        Prism.highlightElement(element[0], false)
                    }
                },
                controller: function ($scope, $element) {
                }
            };
        })
        .directive('popper', ['uuId', 'floating','$timeout', function (uuId, floating, $timeout) {
            return {
                restrict: 'A',
                // transclude:true,
                // templateUrl:'./components/mob-popper.html',
                // replace:true,
                compile: function () {
                    return {
                        post: function (scope, element, attr) {
                            let popper = function() {
                                const targetList = element[0].querySelectorAll('.mob_popper__target');
                                if (angular.isUndefined(targetList) || targetList.length === 0) {
                                    console.warn('targetList元素不存在')
                                    return;
                                }
                                const floatingDomList = element[0].querySelectorAll('.mob-popper');
                                if (angular.isUndefined(floatingDomList) || floatingDomList.length === 0) {
                                    console.warn('floatingDomList元素不存在')
                                    return;
                                }
                                let popperConfig = {}
                                angular.forEach(targetList, function (target) {
                                    let popperRole = target.getAttribute('popper-role');
                                    let roles = popperRole.split(",");
                                    angular.forEach(roles, function (role) {
                                        popperConfig[role] = {
                                            target
                                        }
                                    })
                                })
                                angular.forEach(floatingDomList,function(floatingDom){
                                    popperConfig[floatingDom.getAttribute('popper-role')].floatingDom = floatingDom
                                })
                                scope.popper = {}
                                for (let name of Object.keys(popperConfig)) {
                                    let target = popperConfig[name].target;
                                    if (angular.isUndefined(target)) {
                                        console.warn(`${name} target is undefined`)
                                        continue;
                                    }
                                    let floatingDom = popperConfig[name].floatingDom;
                                    if (angular.isUndefined(floatingDom)) {
                                        console.warn(`${name} floatingDom is undefined`)
                                        continue;
                                    }
                                    scope.popper[name] = {
                                        target,
                                        floatingDom,
                                        popperShow:false
                                    }
                                    // 给浮动元素 生成唯一id
                                    floatingDom.id = uuId.generate()
                                    // 给目标元素绑定唯一id
                                    target.setAttribute('popper-id', floatingDom.id)
                                    scope.popperId = floatingDom.id

                                    scope.popper[name].show = function () {
                                        if (scope.popper[name].popper) {
                                            return;
                                        }
                                        scope.popper[name].popper = true
                                        floatingDom.style.display = 'block';
                                        floatingDom.style.zIndex = '100';
                                        floating.computePosition(scope, target, floatingDom)
                                        debugger
                                        setTimeout(() => {
                                            floatingDom.querySelector('.mob-popper__inner').style.overflow = 'auto';
                                        }, 300)

                                    }
                                    /**
                                     * 自动更新布局的
                                     */
                                    scope.popper[name].showAutoUpdate = function () {
                                        if (scope.popper[name].popper) {
                                            return;
                                        }
                                        scope.popper[name].popper = true
                                        floatingDom.style.display = 'block';
                                        floatingDom.style.zIndex = '100';
                                        scope.popper[name].showAutoUpdateCleanUp = floating.autoUpdateComputePosition(scope, target, floatingDom)
                                        debugger
                                        setTimeout(() => {
                                            console.log('1')
                                            floatingDom.querySelector('.mob-popper__inner').style.overflow = 'auto';
                                        }, 300)

                                    }

                                    scope.popper[name].hide = function () {
                                        scope.popper[name].popper = false
                                        floatingDom.querySelector('.mob-popper__inner').style.overflow = 'hidden';
                                        floatingDom.style.opacity = 0;
                                        floatingDom.style.height = '0';
                                        scope.popper[name].showAutoUpdateCleanUp && scope.popper[name].showAutoUpdateCleanUp()
                                        setTimeout(function () {
                                            floatingDom.style.display = '';
                                        }, 300)
                                    }

                                }
                            }
                            $timeout(()=>{popper()},100)
                        }
                    }
                },
                controller: function ($scope, $element) {
                }
            };
        }])
        .directive('focusOut', ['uuId', 'floating', function (uuId, floating) {
            return {
                restrict: 'A',
                compile: function () {
                    return {
                        post: function (scope, element, attr) {
                            document.addEventListener('click', function (e) {
                                let focus = element[0].contains(e.target)
                                scope.$apply(function () {
                                    scope.$eventListener && scope.$eventListener.focusOut && scope.$eventListener.focusOut(e, focus)
                                })
                                e.preventDefault()
                                e.stopPropagation()
                            });
                        }
                    }
                },
            };
        }])
    ;


    app
        .factory('slot', ['$compile', function ($compile) {
            return {
                replace: function (scope, element, transcludeFn) {
                    transcludeFn(scope, function (clone) {
                        scope.$slot = {}
                        if (!clone) {
                            return
                        }
                        // scope.$slot.hasSlot = true
                        scope.$slot.slotSet = new Set()

                        let slotMap = new Map();
                        for (let e of clone) {
                            if (!angular.isFunction(e.getAttribute)) {
                                continue;
                            }
                            let slotName = e.getAttribute('slot-name')
                            slotMap.set(slotName, e);
                            scope.$slot.slotSet.add(slotName)
                        }

                        let slotList = element[0].querySelectorAll("slot")
                        if (!slotList || slotList.length === 0) {
                            return;
                        }

                        for (innerSlot of slotList) {
                            // 获取组件内部的插槽
                            let slotName = innerSlot.getAttribute('name')
                            if (!slotName || slotName.length === 0) {
                                return
                            }
                            // 根据名称获取外部传入的插槽
                            let slot = slotMap.get(slotName)
                            if (!slot) {
                                continue;
                            }
                            slot = $compile(slot)(scope)[0];
                            innerSlot.parentNode.replaceChild(slot, innerSlot);
                        }
                    })
                },
                appendChild: function (scope, element, childElement) {
                    if (null == element) {
                        return
                    }
                    element.appendChild($compile(childElement)(scope)[0])
                }
            }
        }])
        .factory('attrHelp', [function () {
            return {
                expose: function (ctrl, attrs) {
                    for (let k of Object.keys(attrs)) {
                        if (k.indexOf("$") >= 0) {
                            continue;
                        }
                        if (k.startsWith('ng')) {
                            continue
                        }
                        // 获取属性值
                        if (BOOLEAN_CUSTOM_ATTR.has(k)) {
                            ctrl[k] = !!attrs[k]
                        }
                        // if ("" === v) {
                        //     scope.$attrs[k] = true
                        // } else {
                        //     scope.$attrs[k] = attrs[k]
                        // }
                    }
                }
            }
        }])
        .factory('uuId', [function () {
            return {
                generate: function getUuid() {
                    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                        var r = Math.random() * 16 | 0,
                            v = c == 'x' ? r : (r & 0x3 | 0x8);
                        return v.toString(16);
                    });
                }
            }
        }])
        .factory('floating', function () {
            // 箭头class
            const arrowClassStyle = ['top','right','bottom','left']

            function setFloatingWidth(scope, target, floating) {
                const {width: targetWidth} = target.getBoundingClientRect()
                floating.style.minWidth = targetWidth + 'px';
            }
            function setFloatingHeight(scope, target, floating) {
                floating.style.height = 'auto';
                const {height} = floating.getBoundingClientRect()
                floating.style.height = 0;
                floating.offsetHeight
                floating.style.height = (height > 200 ? 200 : height) + 'px';
                floating.style.opacity = 1;
            }
            function computePosition(scope, target, floating, autoUpdate) {
                // 获取箭头元素
                let arrowElement = floating.querySelector('.mob-popper__arrow');
                window.FloatingUIDOM.computePosition(target, floating, {
                        placement: 'bottom-start',
                        middleware: [
                            window.FloatingUIDOM.flip(),// y轴自适应
                            window.FloatingUIDOM.shift(), // x轴自适应
                            window.FloatingUIDOM.offset(5), // 与目标组件的  空隙
                            window.FloatingUIDOM.arrow({element: arrowElement}), // 箭头
                            // window.FloatingUIDOM.autoPlacement(), // 使用最大空间策略（乐观）

                        ]
                    }
                ).then(({x, y, placement, middlewareData}) => {
                    Object.assign(floating.style, {
                        left: `${x}px`,
                        top: `${y}px`,
                    });

                    const {x: arrowX, y: arrowY} = middlewareData.arrow;

                    const staticSide = {
                        top: 'bottom',
                        right: 'left',
                        bottom: 'top',
                        left: 'right',
                    }[placement.split('-')[0]];

                    const classStyle = {
                        top: 'bottom',
                        right: 'left',
                        bottom: 'top',
                        left: 'right',
                    }[placement.split('-')[0]];

                    angular.forEach(arrowClassStyle, function (v) {
                        arrowElement.classList.remove(v)
                    })
                    arrowElement.classList.add(classStyle)

                    Object.assign(arrowElement.style, {
                        left: arrowX != null ? `${arrowX}px` : '',
                        top: arrowY != null ? `${arrowY}px` : '',
                        right: '',
                        bottom: '',
                        [staticSide]: '0px',
                    });
                    if (!autoUpdate) {
                        setFloatingHeight(scope, target, floating)
                    }
                });
            }
            return {
                computePosition: function (scope, target, floating) {
                    setFloatingWidth(scope, target, floating)
                    computePosition(scope, target, floating)
                },

                autoUpdateComputePosition: function (scope, target, floating) {
                    setFloatingWidth(scope, target, floating)
                    setFloatingHeight(scope, target, floating)
                    return window.FloatingUIDOM.autoUpdate(
                        target,
                        floating,
                        ()=>{computePosition(scope, target, floating, true)}
                    );
                }
            };
        })
    ;

    // FIXME 待完善
    app
        .component('mobContainer', {
            transclude: true,
            templateUrl: './components/mob-container.html',
            controller: function ($scope, $element) {}
        })

        .component('mobForm', {// https://segmentfault.com/a/1190000005868488
            transclude: true,
            templateUrl: './components/mob-form.html',
            bindings: {
                model: '=',
                formItem: '<'
            },
            controller: function () {
                this.$onInit = function () {
                }
            }
        })
        .component('mobFormItem', {
            transclude: true,
            templateUrl: './components/mob-form-item.html',
            bindings: {
                model: '=',
                label: '<',
                prop: '<'
            },
            controller: function () {
                this.generateUuid = function () {
                    return Math.random().toString(36).slice(2); // 截取小数点后的字符串
                }

                this.$onInit = function () {
                    this.uuid = this.generateUuid()
                }
            }
        })

        .component('mobSelect', {
            transclude:true,
            templateUrl: './components/mob-select.html',
            bindings: {
                ngModel: '=?',
                ngDisabled:'<?',
                clearable:'<?',
                placeHolder: '<?',
                multiple:'<?',
                collapseTag:'<?',
                change: '&?'
            },
            controller: function ($scope, $element, $timeout) {
                const _that = this
                // 初始化工作
                this.$onInit = function () {
                    // 初始化一个map，存放ngModel的keyValue
                    $scope.collapseTagsList = [];
                    if (angular.isUndefined(this.placeHolder)) {
                        this.placeHolder = '请选择'
                    }
                    if (angular.isUndefined(this.ngModel)) {
                        this.ngModel = []
                    }
                    this.name = `mobSelect_${$scope.$id}`
                }

                this.$onChanges = function (changes) {
                }

                this.$onDestroy = function () {
                }


                this.$postLink = function () {
                    this.initEvent()
                    this.initWatcher()

                }

                // 初始化事件监听
                this.initEvent = function(){
                    $scope.$eventListener = {}
                    // 点击select外部的时候，隐藏下拉框
                    $scope.$eventListener.focusOut = function (e, value) {
                        if (value) {
                            _that.focus()
                            return
                        }
                        $scope.popper.selectDrown.hide()
                    }

                    // 监听optionsInitValue事件
                    $scope.$on(`${_that.name}OptionsInitValue`, function (e, data) {
                        if (!_that.multiple) {
                            _that.placeHolder = data.label ? data.label : data.value
                        }
                        $scope.collapseTagsList.push({label:data.label, value:data.value})

                    })

                    // 监听optionsClick事件
                    $scope.$on(`${_that.name}OptionsClick`, function (e, data) {
                        _that.changeHandle(data)
                        if (!_that.multiple) {
                            $scope.popper.selectDrown.hide()
                        }
                    })

                    // 监听collapseTagsListUpdate事件
                    $scope.$on(`${_that.name}collapseTagsListUpdate`, function (e, data) {
                        _that.collapseTagsListUpdate(data)
                    })
                }

                /**
                 * 初始化事件监听
                 */
                this.initWatcher = function () {
                    $scope.$watchCollection(() => {
                        return _that.ngModel
                    }, function (newArr) {
                        if (angular.isFunction(_that.change)) {
                            _that.change(_that.ngModel)
                        }
                        // 反向通知group下所有的radio绑定的ngModel
                        $scope.$broadcast(`${_that.name}Change`, _that.ngModel)
                    })
                }

                /**
                 * 无工具箱的collapse
                 * @returns {false|string|boolean|*|boolean}
                 */
                this.isCollapseTagsNoTooltip = function (){
                    return !this.ngDisabled &&
                        this.multiple &&
                        this.ngModel.length > 0 &&
                        this.collapseTag
                }

                /**
                 * 是否有多余的tags
                 */
                this.isCollapseTagsHasRedundant = function () {
                    return this.multiple && this.ngModel.length > 1
                }

                /**
                 * 点击事件
                 */
                this.clickHandler = function () {
                    if (this.ngDisabled) {
                        return
                    }
                    if ($scope.popper.selectDrown.popper) {
                        $scope.popper.selectDrown.hide()
                    } else {
                        // if (this.multiple) {// 多选的时候，才使用动态更新popper。动态定位的popper还是比较消耗性能的
                            // $scope.popper.selectDrown.showAutoUpdate()
                        // } else {
                            $scope.popper.selectDrown.showAutoUpdate()
                        // }
                        this.focus()
                    }
                }

                /**
                 * 重新聚焦
                 */
                this.focus = function () {
                    let selectSection = $element[0].querySelector('.mob-select__selection')
                    selectSection.querySelector('input').focus()
                }

                // 是否显示清除按钮
                this.showClear = function () {
                    return this.clearable &&
                        !this.ngDisabled &&
                        this.ngModel && this.ngModel.length > 0
                }
                /**
                 * 变动通知
                 */
                this.changeHandle = function (data) {
                    if (this.multiple) {
                        if (Array.isArray(data) && data.length === 0) {
                            this.ngModel = []
                        } else {
                            // 判断model中是否包含
                            if (this.ngModel.includes(data.value)) {
                                this.ngModel.splice(this.ngModel.indexOf(data.value), 1)
                            } else {
                                this.ngModel.push(data.value)
                            }
                        }
                    } else {
                        this.ngModel = data.value
                        this.placeHolder = data.label ? data.label : data.value ? data.value : '请选择'
                    }
                }

                this.collapseTagsListUpdate = function (data) {
                    if (!this.multiple) {
                        return
                    }
                    if (Array.isArray(data) && data.length === 0) {
                        $scope.collapseTagsList = []
                        return
                    }
                    let winIndex = $scope.collapseTagsList.findIndex(obj => {
                        return obj.value === data.value
                    })
                    // 判断model中是否包含
                    if (winIndex > -1) {
                        $scope.collapseTagsList.splice(winIndex, 1)
                    } else {
                        $scope.collapseTagsList.push(data)
                    }
                }
                /**
                 * 清空input内容
                 */
                this.clean = function () {
                    this.focus()
                    if (this.multiple) {
                        this.changeHandle([])
                    } else {
                        this.changeHandle('')
                    }
                }

                /**
                 * 多选移除
                 * @param data
                 */
                this.collapseRemove = function (event, data){
                    this.changeHandle(data)
                    event.preventDefault()
                    event.stopPropagation()
                }
            }
        })
        .component('mobSelectOptions', {
            transclude: {
                'slot':'?mobContainer'
            },
            templateUrl: './components/mob-select-options.html',
            require: {
                'mobSelect': '^mobSelect'
            },
            bindings: {
                ngDisabled:'<?',
                label: '<?',
                value: '<?'
            },
            controller: function ($scope, $element, uuId, $transclude) {
                const _that = this
                // 初始化工作
                this.$onInit = function () {
                    console.log($transclude.isSlotFilled('slot'))
                    $scope.isSlot = $transclude.isSlotFilled('slot')
                    $scope.active = false
                    this.name = this.mobSelect.name
                    // 监听父组件的通知事件
                    $scope.$on(`${_that.name}Change`, function (e, data) {
                        let hasChange = _that.change(data);
                        // 通知父组件更新ngModel的cache
                        if (hasChange) {
                            $scope.$emit(`${_that.name}collapseTagsListUpdate`, {
                                label: _that.label,
                                value: _that.getValue()
                            })
                        }
                    })
                }

                this.$onChanges = function (changes) {}

                this.$onDestroy = function () {
                }

                this.$postLink = function () {
                    this.initValue()
                }

                this.initValue = function () {
                    let hasChange = this.change(this.mobSelect.ngModel);
                    if (hasChange) {
                        $scope.$emit(`${_that.name}OptionsInitValue`, {label: this.label, value: _that.getValue()})
                    }
                }

                this.change = function (data) {
                    if (this.ngDisabled) {
                        return false
                    }
                    let temporaryActive = false
                    if (Array.isArray(data)) {
                        temporaryActive = data.includes(this.getValue())
                    } else {
                        temporaryActive = data === this.getValue()
                    }
                    if (temporaryActive !== $scope.active) {
                        $scope.active = temporaryActive;
                        return true
                    } else {
                        return false
                    }
                }

                // 获取options的Value
                this.getValue = function (){
                    // 优先取value，然后是label
                    return this.value ? this.value : this.label
                }
                // options的点击事件，被点击时，通知父组件
                this.clickHandler = function () {
                    if (this.ngDisabled) {
                        return
                    }
                    let val = this.getValue()

                    $scope.$emit(`${_that.name}OptionsClick`, {label: this.label, value: val})
                }
            }
        })
        .component('mobSelectCollapse', {
            transclude:true,
            templateUrl: './components/mob-select-collapse.html',
            require: {
                'mobSelect': '?^mobSelect'
            },
            bindings: {
                label: '<',
                value: '<?'
            },
            controller: function ($scope, $element, uuId, floating) {
                // 初始化工作
                this.$onInit = function () {
                }

                this.$onChanges = function (changes) {}

                this.$onDestroy = function () {}

                this.$postLink = function () {}

                // 获取options的Value
                this.getValue = function (){
                    // 优先取value，然后是label
                    return this.value ? this.value : this.label
                }
                // options的点击事件，被点击时，通知父组件
                this.clickHandler = function () {
                    if (this.ngDisabled) {
                        return
                    }
                    $scope.active = !$scope.active
                    let val = this.getValue()
                    $scope.$emit('selectOptionsClick', {label: this.label,value:this.value})
                }
            }
        })

    ;


    app
        .component('mobDivider', {
            transclude: true,
            templateUrl: './components/mob-divider.html',
            bindings: {
                horizontal: '<?',
                vertical: '<?',
                borderStyle: '<'
            },
            controller: function ($scope) {
                this.$onInit = function () {
                    if (angular.isUndefined(this.horizontal)) {
                        this.horizontal = true;
                    }
                }
            }
        })
        .component('mobIcon', {
            transclude: true,
            templateUrl: './components/mob-icon.html',
            bindings: {},
            controller: function ($scope) {
                // 初始化工作
                this.$onInit = function () {
                }


                this.$onChanges = function (changes) {

                }

                this.$onDestroy = function () {

                }


                this.$postLink = function () {
                }
            }
        })
        .component('mobIconDownArrow', {
            templateUrl: './icon/downArrow.html',
        })
        .component('mobIconCircleClose', {
            templateUrl: './icon/circleClose.html',
        })
        .component('mobIconClose', {
            templateUrl: './icon/close.html',
        })
        .component('mobIconVisible', {
            templateUrl: './icon/visible.html',
        })
        .component('mobIconInvisible', {
            templateUrl: './icon/invisible.html',
        })
        .component('mobIconCalendar', {
            templateUrl: './icon/calendar.html',
        })
        .component('mobIconSearch', {
            templateUrl: './icon/search.html',
        })
        .component('mobIconIncrease', {
            templateUrl: './icon/increase.html',
        })
        .component('mobIconDecrease', {
            templateUrl: './icon/decrease.html',
        })
    ;
    </script>

    </html>
